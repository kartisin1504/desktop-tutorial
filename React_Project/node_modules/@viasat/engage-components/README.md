# Engage Components

Engage platform reusable components and utilities:
https://pages.git.viasat.com/VDUB/engage-components/

# Installation

- NodeJS >= 14.15.1

- `nvm install`

> Optional: Set the default version in nvm. nvm alias default is 14.15.1.

# Development

Components should be developed in isolation of a client app, develop/debug using storybook:

- `npm run storybook`

You can also link with your client app (see `Linking` below), and to listen to code changes, run:

- `npm run start`

# Production

- `npm run build`

# Unit Test

- `npm run test`
- `npm run test -- -u`

# Visual Regression Tests

- `npm run visual-regression`

# Usage of components in client project

```
npm i --save @viasat/engage-components
```

## Client projects requirements

1. These libraries are not bundled with `@viasat/engage-components` and are required dependencies in your project:

- [**react**](https://www.npmjs.com/package/react)
- [**react-dom**](https://www.npmjs.com/package/react-dom)
- [**styled-components**](https://www.npmjs.com/package/styled-components)

2. These components assume you have some CSS normalization, for example you can use:

   `"normalize.css": "^8.0.1"`

   `import '../node_modules/normalize.css/normalize.css';`

3. These components assume you are using the correct Viasat fonts. These are not bundled with these components, however you can copy them into your client project from here:
   `public/fonts`
   and see how they are setup for use here:
   `.storybook/preview-head.html`

4. Some of these components use smooth scrolling in CSS, you may need a polyfill for this in your client code to support all browsers, for example:

   `"styled-components": "^5.1.1"`

   `import smoothscroll from 'smoothscroll-polyfill';`

   `smoothscroll.polyfill();`

## Example usage

```js
import {ThemeProvider} from 'styled-components';
import {theme} from '@viasat/engage-components';
import {Button, Text} from '@viasat/engage-components/lib/components/beam';

const Example = (props) => {
  return (
    <ThemeProvider theme={theme}>
      <Button background="red">Click Me :)</Button>
      <Text sx={{lineHeight: '24px'}}>I am some text</Text>
    </ThemeProvider>
  );
};
```

## Theming

The `engage-components` theme is defined by the theme object as exported by `/theme/theme.js`.
The structure and values in this theme is sufficient to make all the `engage-components` work out-of-the-box, and it is also sufficiently generic that it can be used as a theme in any client UX these components are used in. It is unlikely that you will need to add to the theme - in most cases any changes you will need to make will be to the color palette values to allow for reskinning).

### Theme structure

| Theme Category | Description                                                                                                                                                                                        |
| -------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| breakpoints    | defaults to 6 breakpoints `["320px", "414px", "768px", "1024px", "1441px", "1920px"]`. Any style value defined as an array will use these breakpoints: https://styled-system.com/responsive-styles |
| space          | tokens for margin and padding values                                                                                                                                                               |
| sizes          | tokens for heights, widths etc                                                                                                                                                                     |
| colors         | tokens for BEAM color pallette, and configurable aliases corresponding to: https://material.io/design/color/the-color-system.html                                                                  |
| borders        | tokens for borders                                                                                                                                                                                 |
| radii          | tokens for radii                                                                                                                                                                                   |
| shadows        | tokens for text and box shadow                                                                                                                                                                     |
| fonts          | default body and heading fonts                                                                                                                                                                     |
| fontSizes      | tokens for font sizes                                                                                                                                                                              |
| fontFamily     | default fontFamily                                                                                                                                                                                 |
| fontWeights    | range of font weight sizes                                                                                                                                                                         |
| lineHeights    | range of font line height sizes                                                                                                                                                                    |
| letterSpacings | range of letter spacings                                                                                                                                                                           |
| borderWidths   | range of border widths                                                                                                                                                                             |
|                |                                                                                                                                                                                                    |  |

Read here for more on how theme categories and tokens map to CSS: https://styled-system.com/table

Along with `theme tokens`, each category in the theme will also typically have `alias tokens`, used to contain values that are frequently used throughout the `engage-components`, such as body text, primary and secondary colors, default fonts and so on.

When adding components to this library ensure to style them using `alias tokens` where appropriate, as client UXs will be able to change these aliases in any theme override to allow easier visual customisation. Not every style setting is so generic as to require using an alias however, and in these scenarios you should use a `theme token` for style values. This will ensure a consistent and easily configurable UX.

### Color Palette

Along with default BEAM palette colors, the theme provides additional color aliases that alone can be used to configure component colors in a very flexible way, which should cater for most re-skinning requirements.

These aliases consist of a `primary` color (and graded variants), a `secondary` color (and graded variants), `surface` and `background` colors, and a collection of `on` aliases which are used for iconography and typography - `on` meaning colors used "on top of" other alias colors.

This palette structure is based on the [Material Design color system.](https://material.io/design/color/the-color-system.html), and defaults to Viasats dark theme skin.

_`Always use an alias from this color palette when adding any color to your component.`_

### Variants

Some common components require more fine-grained targeted styling by the theme. These can be defined in the `variant` of the theme structure, which defaults to the following (and can be extended, or added to for your own custom client components):

| Variant          | Description                                             |
| ---------------- | ------------------------------------------------------- |
| variants.link    | Link component variants: primary, secondary, etc        |
| variants.spinner | Spinner component variants: small, medium, large        |
| variants.menu    | Menu component variants: primary                        |
| buttons          | Button component variants: primary, secondary, etc      |
| text             | Heading component variants: heading.h1, heading.h2, etc |

Read here for more on variants: https://rebassjs.org/variants

### Customizing theme

Most theming should work out of the box, and any component styling/enhancement can be performed by providing styles using the components `sx` or styled-system props. However if your client has different or custom spacing, sizings, palettes, or variants you can either copy the theme structure as defined in `/theme` and provide your own to styled-components `ThemeProvider`, or extend the existing theme (using a deep merge), for example, adding custom size, color, and breakpoint tokens. This will typically involve setting custom values for the `alias tokens`, but you can also change any theme tokens:

```js
import {ThemeProvider} from 'styled-components';
import {theme} from '@viasat/engage-components';

theme.space = {...theme.space, ...{600: '120px', 700: '200px'}};
theme.colors = {
  ...theme.colors,
  ...{text: {body: '#110000'}},
};
theme.breakpoints = ['320px', '414px', '768px', '1024px', '1441px', '1920px'];

const Example = (props) => {
  return (
    <ThemeProvider theme={theme}>
      <Button background="red">Click Me :)</Button>
      <Text sx={{lineHeight: '24px'}}>I am some text</Text>
    </ThemeProvider>
  );
};
```

## Supporting RTL components

Components should be designed to work in RTL layouts. For simple component this will mean no extra steps other than testing it in Storybook using the RTL icon.

On switching to an RTL language the browser UX will flip horizontally, and any of your component styles that refer to `right` or `left` will automatically be rewritten to their inverse label, for example `padding-left:10px` will change to `padding-right:10px`.

There are scenarios where more fine-grained control is required, where you may not want this to occur for your specific components use case. Here are some techniques you can use to achieve this control:

1. You can target styles for an rtl or ltr layout specifically through CSS, for example:

   ```json
   {
     "[dir=\"rtl\"] &": {
       "backgroundColor": "red"
     }
   }
   ```

   Note: if you use this method you need to verify the specifity. For example, applying it to a Flex element, will apply it to all Flex elements on the page.

1. In the above example any CSS containing `right` or `left` labels will still be flipped, you can prevent this by adding an opt-out `rtl:ignore` comment in your CSS, for example set marginRight:300px for ltr and rtl layouts: `marginRight: '300px/*rtl:ignore*/'`

   These comments are known as `directives` - [see here for additional options](https://github.com/migggz/stylis-rtlcss#options-)

1. You can check if the layout is `rtl` programatically: `document.body.dir === 'rtl'`

# Developing from client project

Development of Engage components should be performed independently of any client UX using Storybook as a client (`npm run storybook`). However sometimes it is useful to develop components in-tandem with a client UX - you can link to your component source using `npm link`:

## Setup Link

1. in `engage-components` project, run:

- `npm link`
- `npm run start`

2. in your client project, run:

- `npm link @viasat/engage-components`

Now your client project will use the build of your local `engage-components`

### Linking Troublshooting:

1. If you get a runtime error in your project (or your project us using an older version of React), ensure to add the following at a minimum to your clients webpack config (depending on your project configuration you may also need to add aliases for other libs like `redux` etc):

```json
{
  "resolve": {
    "alias": {
      "react": path.resolve("./node_modules/react"),
      "react-dom": path.resolve("./node_modules/react-dom"),
      "styled-components": path.resolve("./node_modules/styled-components"),
      "styled-system": path.resolve("./node_modules/styled-system")
    }
  }
}
```

2. If you get jest test errors in your project, ensure to add the following to `moduleNameMapper` in your jest config file (depending on your project configuration you may also need to add aliases for other libs like `redux` etc):

```json
{
  "^react($|/.+)": "<rootDir>/node_modules/react$1",
  "^styled-components($|/.+)": "<rootDir>/node_modules/styled-components$1",
  "^styled-system($|/.+)": "<rootDir>/node_modules/styled-system$1"
}
```

3. running `npm i` on your client project will perform an unlink

## UnLink

1. in client project, run:

- `npm unlink --no-save @viasat/engage-components && npm i`

2. in this project:

- `npm unlink`

# Publishing

Publishing involves versioning, packing the built code, and publishing it to artifactory. This process is automated as part of our jenkins pipeline. When your feature branch is approved and merged to develop, a patch build will occur.

- If you want a minor or major version bump, simply update the package.json version as required, and the next published version will contain that release number.
- If you want to see what version was published [see here most recent package version](https://git.viasat.com/VDUB/engage-components/blob/develop/package.json).

## Notes

If your components were not published as expected, it was most likely a build failure in jenkins during the publish process. This can be caused if you have not committed a modified `package-lock.json` file. Ensure to commit this file!

# Publish Storybook to github pages

Run the following command to deploy _your current branch_ storybook build:

```
npm run deploy-storybook
```

Storybook will be published to here: https://pages.git.viasat.com/VDUB/engage-components/
